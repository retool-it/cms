version:            '3.3'

services:
    app:
        image:      retool/cms:development
        build:      ./app
        env_file:   .env
        restart:    always
        depends_on:
            - db
        ports:
            - 8000:8000
        volumes:
            - ./app:/usr/src/app
    db:
        image:      postgres:alpine
        restart:    always
        env_file:   .env
        volumes:
            - db_data:/var/lib/postgresql/data
    web:
        image:      retool/nginx:development
        build:      ./web
        restart:    always
        depends_on:
            - app
        ports:
            - 80:80
        volumes:
            - ./web/default.conf:/etc/nginx/conf.d/default.conf:ro
            - ./app/static:/usr/share/nginx/html:ro
volumes:
    db_data:
